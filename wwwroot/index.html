<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KTSimulator</title>
    <base href="/" />
    <link rel="stylesheet" href="css/app.css" />
    <link href="css/ktlayout.css" rel="stylesheet" />

    <!-- If you add any scoped CSS files, uncomment the following to load them
    <link href="KTSimulator.styles.css" rel="stylesheet" /> -->
</head>

<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <div id="user-info" style="display: none; padding: 0.5rem 1rem; background: #222; color: white; font-family: sans-serif;">
        Logget inn som: <span id="user-name"></span>
        <button onclick="logout()" style="margin-left: 1rem; padding: 0.2rem 0.5rem;">Logg ut</button>
    </div>

    <div id="username-setup" style="display:none; margin-top:1rem;">
        <label for="username">Velg brukernavn:</label>
        <input type="text" id="username" />
        <button onclick="saveUsername()">Lagre</button>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>

    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.open(); // viser login-skjema automatisk
                }
            });
        }
    </script>

    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
        function logout() {
            window.netlifyIdentity.logout();
        }

        function saveUsername() {
            const user = window.netlifyIdentity.currentUser();
            const newUsername = document.getElementById("username").value;

            user.update({
                app_metadata: {
                    username: newUsername
                }
            }).then(updatedUser => {
                document.getElementById("user-name").textContent = updatedUser.app_metadata.username;
                document.getElementById("username-setup").style.display = "none";
            });
        }

        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.open();
                    document.getElementById("app").style.display = "none";
                } else {
                    showApp(user);
                }
            });

            window.netlifyIdentity.on("login", user => {
                showApp(user);
            });

            window.netlifyIdentity.on("logout", () => {
                location.reload();
            });
        }

        function showApp(user) {
            document.getElementById("app").style.display = "block";
            document.getElementById("user-info").style.display = "block";

            const username = user.app_metadata && user.app_metadata.username;
            if (username) {
                document.getElementById("user-name").textContent = username;
            } else {
                document.getElementById("user-name").textContent = user.email;
                document.getElementById("username-setup").style.display = "block";
            }
        }
    </script>





</body>

</html>
